import{R as v,j as e,g as y,h as C,e as $,r as b,i as M,f as T,A as k,b as E,C as A}from"./app.js";import{M as F}from"./message-circle.js";const D=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],P=["L","M","X","J","V","S","D"];function R(t,s){const a=new Date(t,s,1),l=new Date(t,s+1,0),r=(a.getDay()+6)%7,c=l.getDate(),u=[];let d=[];for(let x=0;x<r;x++)d.push(null);for(let x=1;x<=c;x++)d.push(new Date(t,s,x)),d.length===7&&(u.push(d),d=[]);if(d.length>0){for(;d.length<7;)d.push(null);u.push(d)}return u}function Y(t){const s=new Date;s.setHours(0,0,0,0);const a=new Date(t);return a.setHours(0,0,0,0),a<s}function S(t){const s=new Date;return t.getDate()===s.getDate()&&t.getMonth()===s.getMonth()&&t.getFullYear()===s.getFullYear()}function W(t){const s=new Date,[a,l]=t.split(":").map(Number),n=new Date;return n.setHours(a,l,0,0),n<s}function j(t){return`${t.getDate()} de ${D[t.getMonth()]} de ${t.getFullYear()}`}const I=({selectedDate:t,onSelectDate:s})=>{const[a,l]=v.useState(new Date),n=a.getFullYear(),r=a.getMonth(),c=R(n,r),u=()=>{const m=new Date;(r>m.getMonth()||n>m.getFullYear())&&l(new Date(n,r-1,1))},d=()=>{l(new Date(n,r+1,1))},x=(m,o)=>o?m.getDate()===o.getDate()&&m.getMonth()===o.getMonth()&&m.getFullYear()===o.getFullYear():!1;return e.jsxs("div",{className:"bg-slate-800/80 rounded-xl p-4 border border-slate-700 shadow-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:u,className:"p-1 hover:bg-slate-700 rounded-lg text-slate-300 disabled:opacity-30",disabled:r===new Date().getMonth()&&n===new Date().getFullYear(),children:e.jsx(y,{className:"w-5 h-5"})}),e.jsxs("h3",{className:"text-white font-bold capitalize",children:[D[r]," ",e.jsx("span",{className:"text-slate-500 text-sm ml-1",children:n})]}),e.jsx("button",{onClick:d,className:"p-1 hover:bg-slate-700 rounded-lg text-slate-300",children:e.jsx(C,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"grid grid-cols-7 mb-2",children:P.map(m=>e.jsx("div",{className:"text-center text-xs font-bold text-slate-500 py-1",children:m},m))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:c.map((m,o)=>e.jsx(v.Fragment,{children:m.map((h,f)=>{if(!h)return e.jsx("div",{className:"aspect-square"},`${o}-${f}`);const i=Y(h),p=x(h,t),N=S(h);return e.jsxs("button",{disabled:i,onClick:()=>s(h),className:`
                                        aspect-square rounded-lg flex items-center justify-center text-sm font-medium transition-all relative
                                        ${i?"text-slate-600 opacity-50 cursor-not-allowed":p?"bg-rose-500 text-white shadow-lg shadow-rose-500/30":"text-slate-300 hover:bg-slate-700 hover:text-white bg-slate-800"}
                                        ${N&&!p?"border border-rose-500/50 text-rose-400":""}
                                    `,children:[h.getDate(),N&&e.jsx("div",{className:"absolute bottom-1 w-1 h-1 bg-current rounded-full opacity-50"})]},h.toISOString())})},o))})]})},B=["10:00","11:30","16:00","17:30"],H=({selectedDate:t,selectedSlot:s,onSelectSlot:a})=>{if(!t)return e.jsxs("div",{className:"text-center py-8 text-slate-500 border border-dashed border-slate-700 rounded-xl bg-slate-800/30",children:[e.jsx($,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Selecciona un dÃ­a primero"})]});const l=n=>S(t)?W(n):!1;return e.jsx("div",{className:"grid grid-cols-2 gap-3 animate-fade-in",children:B.map(n=>{const r=l(n),c=s===n;return e.jsx("button",{disabled:r,onClick:()=>a(n),className:`
                            py-3 px-4 rounded-xl border font-bold flex items-center justify-center transition-all
                            ${r?"bg-slate-900 border-slate-800 text-slate-600 cursor-not-allowed line-through":c?"bg-rose-500 border-rose-500 text-white shadow-lg shadow-rose-500/20":"bg-slate-800 border-slate-700 text-slate-300 hover:border-slate-500 hover:bg-slate-750"}
                        `,children:n},n)})})};function g(t){return!t||t.trim().length<3?"El nombre debe tener al menos 3 caracteres.":null}function w(t){const s=t.replace(/[\s-]/g,"");return!/^\+?d{9,15}$/.test(s)&&!/^\d{9,15}$/.test(s)?"Introduce un telÃ©fono vÃ¡lido (mÃ­nimo 9 dÃ­gitos).":null}const O=({data:t,onChange:s,onSubmit:a,isSubmitting:l})=>{const[n,r]=b.useState({name:!1,phone:!1}),[c,u]=b.useState({});b.useEffect(()=>{n.name&&u(o=>({...o,name:g(t.name)}))},[t.name,n.name]),b.useEffect(()=>{n.phone&&u(o=>({...o,phone:w(t.phone)}))},[t.phone,n.phone]);const d=(o,h)=>{s({...t,[o]:h})},x=o=>{r({...n,[o]:!0}),o==="name"&&u(h=>({...h,name:g(t.name)})),o==="phone"&&u(h=>({...h,phone:w(t.phone)}))},m=!g(t.name)&&!w(t.phone)&&t.name&&t.phone;return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Tus datos de contacto"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm text-slate-300 ml-1",children:"Nombre Completo"}),e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"absolute left-3 top-3.5 w-5 h-5 text-slate-500"}),e.jsx("input",{type:"text",value:t.name,onChange:o=>d("name",o.target.value),onBlur:()=>x("name"),className:`w-full bg-slate-800 border rounded-xl py-3 pl-10 pr-4 text-white placeholder-slate-600 focus:outline-none focus:ring-1 focus:ring-rose-500 transition-all ${c.name?"border-red-500":"border-slate-700"}`,placeholder:"Tu nombre"})]}),c.name&&e.jsx("p",{className:"text-xs text-red-400 ml-1",children:c.name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm text-slate-300 ml-1",children:"TelÃ©fono (WhatsApp)"}),e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-3.5 w-5 h-5 text-slate-500"}),e.jsx("input",{type:"tel",value:t.phone,onChange:o=>d("phone",o.target.value),onBlur:()=>x("phone"),className:`w-full bg-slate-800 border rounded-xl py-3 pl-10 pr-4 text-white placeholder-slate-600 focus:outline-none focus:ring-1 focus:ring-rose-500 transition-all ${c.phone?"border-red-500":"border-slate-700"}`,placeholder:"600 000 000"})]}),c.phone&&e.jsx("p",{className:"text-xs text-red-400 ml-1",children:c.phone})]})]}),e.jsxs("button",{"full-width":"true",onClick:a,disabled:!m||l,className:"w-full bg-rose-600 hover:bg-rose-500 disabled:bg-slate-700 disabled:text-slate-500 disabled:cursor-not-allowed text-white font-bold py-3.5 rounded-xl flex items-center justify-center gap-2 transition-all shadow-lg hover:shadow-rose-900/20",children:[l?"Procesando...":"Confirmar Reserva"," ",e.jsx(k,{className:"w-5 h-5"})]})]})};function V(t,s="34"){let a=t.replace(/\D/g,"");return a.startsWith("00")&&(a=a.substring(2)),a.length===9?`${s}${a}`:a}function _(t,s){const a=[`ðŸ“… *Nueva Reserva* ${s?`para ${s}`:""}`,`ðŸ‘¤ Cliente: ${t.name}`,`ðŸ“ž Tel: ${t.phone}`,`ðŸ—“ Fecha: ${j(t.date)}`,`â° Hora: ${t.slot}`];return t.notes&&a.push(`ðŸ“ Notas: ${t.notes}`),a.push(""),a.push("_Enviado desde la web_"),a.join(`
`)}function z(t,s){const a=V(t),l=encodeURIComponent(s);return`https://wa.me/${a}?text=${l}`}const L=({data:t,config:s})=>{const a=_(t,s.businessName),l=z(s.businessPhone,a),n=()=>{window.open(l,"_blank")};return e.jsxs("div",{className:"text-center py-6 animate-fade-in",children:[e.jsx("div",{className:"w-20 h-20 bg-emerald-500/20 rounded-full flex items-center justify-center mx-auto mb-6 border border-emerald-500/30",children:e.jsx(E,{className:"w-10 h-10 text-emerald-400"})}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Â¡Todo listo!"}),e.jsxs("p",{className:"text-slate-300 mb-8 max-w-xs mx-auto",children:["Tu cita estÃ¡ reservada para el ",e.jsx("strong",{children:j(t.date)})," a las ",e.jsx("strong",{children:t.slot}),"."]}),e.jsxs("div",{className:"bg-slate-800 p-6 rounded-xl border border-slate-700 mb-8 text-left",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"Resumen"}),e.jsxs("div",{className:"text-white space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-300",children:"Nombre:"})," ",t.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-300",children:"TelÃ©fono:"})," ",t.phone]})]})]}),e.jsxs("button",{onClick:n,className:"w-full bg-[#25D366] hover:bg-[#20bd5a] text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2 transition-all shadow-lg hover:shadow-emerald-900/20",children:[e.jsx(F,{className:"w-6 h-6"}),"Confirmar por WhatsApp"]}),e.jsx("p",{className:"text-xs text-slate-500 mt-4",children:"Se abrirÃ¡ WhatsApp para enviar los detalles."})]})},U=({currentStep:t})=>{const s=["select","details","confirm"],a=s.indexOf(t);return e.jsx("div",{className:"flex items-center gap-2 mb-6 justify-center",children:s.map((l,n)=>e.jsx("div",{className:`h-1.5 w-8 rounded-full transition-all duration-500 ${n<=a?"bg-rose-500":"bg-slate-700"}`},l))})},G=()=>{const[t,s]=b.useState(null),[a,l]=b.useState({step:"select",selectedDate:null,selectedTimeSlot:null,customerName:"",customerPhone:"",isSubmitting:!1,errors:{}});if(b.useEffect(()=>{const i=window.empcConfig;i?s(i):console.error("EMPC Booking: Config not found")},[]),!t)return null;const{step:n,selectedDate:r,selectedTimeSlot:c,customerName:u,customerPhone:d,isSubmitting:x}=a,m=i=>{l(p=>({...p,selectedDate:i,selectedTimeSlot:null}))},o=i=>{l(p=>({...p,selectedTimeSlot:i}))},h=()=>{r&&c&&l(i=>({...i,step:"details"}))},f=async()=>{l(i=>({...i,isSubmitting:!0})),setTimeout(()=>{l(i=>({...i,isSubmitting:!1,step:"confirm"}))},800)};return e.jsxs("div",{className:"w-full max-w-md mx-auto bg-slate-900 border border-slate-800 rounded-2xl shadow-2xl overflow-hidden font-sans",children:[e.jsxs("div",{className:"bg-slate-800/50 p-4 border-b border-slate-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"text-rose-500 w-5 h-5"}),e.jsx("span",{className:"font-bold text-white text-sm tracking-wide",children:"RESERVAR CITA"})]}),r&&n!=="confirm"&&e.jsx("span",{className:"text-xs font-medium text-rose-400 bg-rose-500/10 px-2 py-1 rounded",children:j(r)})]}),e.jsxs("div",{className:"p-6",children:[e.jsx(U,{currentStep:n}),n==="select"&&e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx(I,{selectedDate:r,onSelectDate:m}),e.jsxs("div",{className:"border-t border-slate-800 pt-6",children:[e.jsx("h4",{className:"text-white font-bold mb-4 text-sm uppercase text-slate-300",children:"Horarios Disponibles"}),e.jsx(H,{selectedDate:r,selectedSlot:c,onSelectSlot:o})]}),e.jsx("button",{disabled:!r||!c,onClick:h,className:"w-full mt-6 bg-white text-slate-900 hover:bg-slate-200 disabled:bg-slate-800 disabled:text-slate-600 font-bold py-3.5 rounded-xl transition-all disabled:cursor-not-allowed",children:"Continuar"})]}),n==="details"&&e.jsx(O,{data:{name:u,phone:d},onChange:i=>l(p=>({...p,customerName:i.name,customerPhone:i.phone})),onSubmit:f,isSubmitting:x}),n==="confirm"&&r&&c&&e.jsx(L,{config:t,data:{name:u,phone:d,date:r,slot:c}}),n==="details"&&e.jsx("button",{onClick:()=>l(i=>({...i,step:"select"})),className:"mt-4 w-full text-slate-500 text-sm hover:text-white pb-2",children:"Volver a calendario"})]})]})};export{G as default};
